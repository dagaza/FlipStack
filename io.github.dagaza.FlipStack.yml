app-id: io.github.dagaza.FlipStack
runtime: org.gnome.Platform
runtime-version: '46'
sdk: org.gnome.Sdk
command: flipstack
finish-args:
  # Networking (needed to add syncing later, disabled for now)
  # - --share=network
  # Display (Wayland + X11 fallback)
  - --socket=fallback-x11
  - --socket=wayland
  # Audio (PulseAudio/Pipewire access for 'paplay')
  - --socket=pulseaudio
  # GPU Acceleration
  - --device=dri
  # X11 Shared Memory (Important for GTK4 performance)
  - --share=ipc

modules:
  - name: flipstack
    buildsystem: simple
    build-commands:
      # --- 1. Create Directories ---
      - mkdir -p /app/bin
      - mkdir -p /app/share/flipstack
      - mkdir -p /app/share/applications
      - mkdir -p /app/share/icons/hicolor/scalable/apps
      - mkdir -p /app/share/metainfo

      # --- 2. Copy Source Code ---
      - cp -r *.py /app/share/flipstack/

      # --- 3. Copy ALL App Resources ---
      - cp -r assets /app/share/flipstack/

      # --- 4. Install System Integration Files ---
      # Launcher Script
      - install -D -m 755 flipstack.sh /app/bin/flipstack
      
      # Desktop File
      - install -D -m 644 io.github.dagaza.FlipStack.desktop /app/share/applications/io.github.dagaza.FlipStack.desktop

      # System Icon (Start Menu) - UPDATED PATH
      - cp assets/icons/io.github.dagaza.FlipStack.svg /app/share/icons/hicolor/scalable/apps/io.github.dagaza.FlipStack.svg

      # AppStream Metadata (Store Page) - Required for Flathub
      - install -D -m 644 io.github.dagaza.FlipStack.metainfo.xml /app/share/metainfo/io.github.dagaza.FlipStack.metainfo.xml

    sources:
      - type: dir
        path: .
